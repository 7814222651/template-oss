name: Audit

runs:
  using: composite
  steps:
    - name: Run Full Audit
      shell: bash
      run: |
        if ! {{ rootNpmPath }} audit; then
          COUNT=$({{ rootNpmPath }} audit --audit-level=none --json | jq -r '.metadata.vulnerabilities.total')
          echo "::warning title=All Vulnerabilities::Found $COUNT"
        fi

    - name: Run Production Audit
      shell: bash
      run: |
        if ! {{ rootNpmPath }} audit --omit=dev; then
          COUNT=$({{ rootNpmPath }} audit --omit=dev --audit-level=none --json | jq -r '.metadata.vulnerabilities.total')
          echo "::error title=Production Vulnerabilities::Found $COUNT"
          exit 1
        fi
